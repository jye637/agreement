<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>114 蔡文國小 - 資通安全保密同意書</title>

<style>
body {
  font-family: "Noto Sans TC", sans-serif;
  background: #eef2f3;
  padding: 20px;
}

.container {
  max-width: 850px;
  margin: 0 auto;
  background: #fff;
  padding: 35px;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

h1 {
  text-align: center;
  color: #0a6847;
  margin-bottom: 20px;
}

label {
  display: block;
  margin-top: 15px;
  font-weight: 600;
}

input[type="text"] {
  padding: 8px;
  width: 180px;
  border-radius: 6px;
  border: 1px solid #bbb;
  margin-left: 8px;
}

.flex-row {
  display: flex;
  align-items: center;
  gap: 10px;
}

button {
  margin-top: 20px;
  padding: 12px 25px;
  font-size: 16px;
  background: #0a6847;
  color: #fff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.2s;
}

button:hover {
  background: #064f35;
}

#clearBtn {
  background: #b80000;
}
#clearBtn:hover {
  background: #7a0000;
}

canvas {
  border: 2px solid #ccc;
  border-radius: 8px;
  margin-top: 8px;
  background: #fff;
}

#status {
  color: #0a6847;
  margin-top: 20px;
  font-size: 18px;
  font-weight: bold;
}

.signature-display img {
  border: 1px solid #ccc;
  margin-top: 10px;
  width: 380px;
  border-radius: 6px;
}
</style>
</head>

<body>
<div class="container">
<h1>蔡文國民小學 資通安全保密同意書</h1>

<p>依據本校資訊安全維護計畫要求全校教職員簽署資通保密同意書如下：</p>
<ol>
  <li>於業務上所知悉之機敏資料及運用之資通系統等，應善盡保管及保密之責。</li>
  <li>相關業務之資訊、文件，不得私自洩漏與業務無關之人員。</li>
  <li>使用即時通訊軟體傳遞公務訊息，其內容不得涉及機密資料。</li>
  <li>遵守本單位資通安全相關法令及規定。</li>
  <li>如有危害資通安全之行為，願負相關責任。</li>
</ol>
<p>如有疑問請洽本校教務處資訊組：07-6076268#723</p>

<form id="consentForm">

  <div class="flex-row">
    <label><input type="checkbox" id="agree"> 我同意</label>

    <label>姓名：<input type="text" id="userName"></label>
  </div>

  <label>
    身分證號後 5 碼：
    <input type="text" id="idLast5" maxlength="5">
  </label>

  <label>請簽名：</label>

  <canvas id="signatureCanvas" width="500" height="200"></canvas>

  <button type="button" id="clearBtn">清除簽名</button>
  <button type="submit">送出資料</button>
</form>

<p id="status"></p>
<div class="signature-display" id="signatureDisplay"></div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCk-1B0IwsSOwlNIn71-LofJRoHzgh6kJQ",
  authDomain: "signup-f163b.firebaseapp.com",
  projectId: "signup-f163b",
  messagingSenderId: "4965735888",
  appId: "1:4965735888:web:6ce33434885f967ed22dd5"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// --- Canvas 簽名 ---
const canvas = document.getElementById("signatureCanvas");
const ctx = canvas.getContext("2d");
ctx.lineWidth = 2;

let drawing = false;
canvas.addEventListener("mousedown", e => { drawing = true; ctx.beginPath(); ctx.moveTo(e.offsetX, e.offsetY); });
canvas.addEventListener("mousemove", e => { if (drawing) { ctx.lineTo(e.offsetX, e.offsetY); ctx.stroke(); }});
canvas.addEventListener("mouseup", () => drawing = false);
canvas.addEventListener("mouseleave", () => drawing = false);

// 清除按鈕
document.getElementById("clearBtn").addEventListener("click", () => {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
});

// --- Submit ---
document.getElementById("consentForm").addEventListener("submit", async e => {
  e.preventDefault();

  const agree = document.getElementById("agree").checked;
  const idLast5 = document.getElementById("idLast5").value.trim();
  const userName = document.getElementById("userName").value.trim();

  if (!agree) { alert("請勾選同意"); return; }
  if (userName.length < 1) { alert("請輸入姓名"); return; }
  if (idLast5.length !== 5) { alert("請輸入正確的身分證後 5 碼"); return; }

  const signatureDataUrl = canvas.toDataURL();

  try {
    await addDoc(collection(db, "signatures"), {
      agree,
      userName,
      idLast5,
      signatureDataUrl,
      timestamp: serverTimestamp()
    });

    const timeStr = new Date().toLocaleString();

    document.getElementById("status").textContent =
      `我們已經收到 ${userName} 的同意書了！（${timeStr}）`;

    document.getElementById("signatureDisplay").innerHTML = `
      <p>姓名：${userName}</p>
      <p>身分證後 5 碼：${idLast5}</p>
      <p>送出時間：${timeStr}</p>
      <img src="${signatureDataUrl}" alt="簽名圖片">
    `;

    // 清空表單
    document.getElementById("agree").checked = false;
    document.getElementById("idLast5").value = "";
    document.getElementById("userName").value = "";
    ctx.clearRect(0,0,canvas.width,canvas.height);

  } catch (error) {
    console.error(error);
    alert("送出失敗，請稍後再試");
  }
});
</script>

</div>
</body>
</html>
