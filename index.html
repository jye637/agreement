<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>資通安全保密同意書</title>
<style>
body{font-family:Noto Sans TC,sans-serif;background:#f5f5f5;padding:20px;}
.container{max-width:800px;margin:0 auto;background:#fff;padding:30px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.1);}
h1{text-align:center;color:#006600;}
label{display:block;margin-top:15px;}
input[type="text"]{padding:8px;width:150px;border-radius:5px;border:1px solid #ccc;}
button{margin-top:20px;padding:10px 20px;background:#006600;color:#fff;border:none;border-radius:5px;cursor:pointer;}
button:hover{background:#004d00;}
canvas{border:1px solid #ccc;margin-top:5px;}
#status{color:green;margin-top:10px;}
</style>
</head>
<body>
<div class="container">
<h1>蔡文國民小學資通安全保密同意書</h1>
<p>依據本校資訊安全維護計畫要求全校教職員簽署資通保密同意書如下：
立書同意人於蔡文國民小學任職，因業務涉及單位重要之資訊及資通系統，故同意下列保密事項：
一、於業務上所知悉之機敏資料及運用之資通系統等，應善盡保管及保密之責。
二、相關業務之資訊、文件，不得私自洩漏與業務無關之人員。
三、使用即時通訊軟體傳遞機關內部公務訊息，其內容不得涉及機密資料。
四、遵守本單位資通安全相關之法令及規定。
五、如有危害本單位資通安全之行為，願負相關之責任。
    相關問題或疑義請洽教務處資訊組，07-6076268#723
</p>

<form id="consentForm">
    <label><input type="checkbox" id="agree"> 我同意</label>
    <label>請輸入身分證號後5碼：<input type="text" id="idLast5" maxlength="5"></label>
    <label>請簽名：</label>
    <canvas id="signatureCanvas" width="400" height="150"></canvas>
    <button type="submit">送出資料</button>
</form>
<p id="status"></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getStorage, ref, uploadString, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    appId: "YOUR_APP_ID"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

const canvas = document.getElementById("signatureCanvas");
const ctx = canvas.getContext("2d");
let drawing=false;

canvas.addEventListener("mousedown",()=>drawing=true);
canvas.addEventListener("mouseup",()=>drawing=false);
canvas.addEventListener("mouseleave",()=>drawing=false);
canvas.addEventListener("mousemove",(e)=>{
    if(!drawing) return;
    ctx.lineWidth=2;
    ctx.lineCap="round";
    ctx.strokeStyle="black";
    ctx.beginPath();
    ctx.moveTo(e.offsetX, e.offsetY);
    ctx.lineTo(e.offsetX+1, e.offsetY+1);
    ctx.stroke();
});

document.getElementById("consentForm").addEventListener("submit", async e=>{
    e.preventDefault();
    const agree = document.getElementById("agree").checked;
    const idLast5 = document.getElementById("idLast5").value.trim();
    if(!agree || idLast5.length!==5){
        alert("請勾選同意並輸入正確身分證後5碼");
        return;
    }

    const signatureDataURL = canvas.toDataURL("image/png");
    const storageRef = ref(storage, `signatures/${idLast5}_${Date.now()}.png`);
    await uploadString(storageRef, signatureDataURL, 'data_url');
    const signatureURL = await getDownloadURL(storageRef);

    await addDoc(collection(db, "signatures"), {
        idLast5,
        agree,
        signature: signatureURL,
        timestamp: serverTimestamp()
    });

    document.getElementById("status").innerText="我們已經收到您的同意書了";
    ctx.clearRect(0,0,canvas.width,canvas.height);
    document.getElementById("consentForm").reset();
});
</script>
</body>
</html>
