<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>報名管理後台</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f9f9f9;
    }

    #contentToPrint {
      background: #fff;
      padding: 20px;
      border: 1px solid #ccc;
      margin-bottom: 20px;
    }

    #signatureContainer {
      margin-top: 10px;
      text-align: center;
    }

    canvas {
      border: 1px solid #000;
      background: #fff;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h1>報名管理後台</h1>

  <!-- 報名內容 -->
  <div id="contentToPrint">
    <h2>學生報名資料</h2>
    <p>姓名: 張小明</p>
    <p>年級: 5年級</p>
    <p>活動: 羽球比賽</p>
    <!-- 其他報名資料可以動態加入 -->
  </div>

  <!-- 簽名區 -->
  <div id="signatureContainer">
    <h3>簽名</h3>
    <canvas id="signatureCanvas" width="400" height="150"></canvas>
    <br>
    <button id="clearSignature">清除簽名</button>
  </div>

  <br>
  <!-- 生成 PDF 按鈕 -->
  <button id="pdfButton">生成 PDF</button>

  <!-- jsPDF 與 html2canvas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    const { jsPDF } = window.jspdf;

    // 簽名功能
    const canvas = document.getElementById('signatureCanvas');
    const ctx = canvas.getContext('2d');
    let drawing = false;

    canvas.addEventListener('mousedown', e => { drawing = true; ctx.beginPath(); ctx.moveTo(e.offsetX, e.offsetY); });
    canvas.addEventListener('mousemove', e => { if (drawing) ctx.lineTo(e.offsetX, e.offsetY); ctx.stroke(); });
    canvas.addEventListener('mouseup', e => { drawing = false; });
    canvas.addEventListener('mouseleave', e => { drawing = false; });

    document.getElementById('clearSignature').addEventListener('click', () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    });

    // 生成 PDF
    document.getElementById('pdfButton').addEventListener('click', async () => {
      const content = document.getElementById('contentToPrint');
      const signature = document.getElementById('signatureCanvas');

      try {
        // 將報名內容轉為 canvas
        const contentCanvas = await html2canvas(content, { backgroundColor: '#fff', scale: 2 });
        const contentImg = contentCanvas.toDataURL('image/png');

        // 將簽名轉為 PNG
        const signatureImg = signature.toDataURL('image/png');

        const doc = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
        const pdfWidth = doc.internal.pageSize.getWidth();
        let yOffset = 0;

        // 加入報名內容
        const contentHeight = (contentCanvas.height * pdfWidth) / contentCanvas.width;
        doc.addImage(contentImg, 'PNG', 0, yOffset, pdfWidth, contentHeight);
        yOffset += contentHeight + 5;

        // 加入簽名
        const signatureHeight = (signature.height * pdfWidth) / signature.width;
        doc.addImage(signatureImg, 'PNG', 0, yOffset, pdfWidth, signatureHeight);

        doc.save('報名資料.pdf');
      } catch (err) {
        console.error('PDF 生成失敗:', err);
        alert('PDF 生成失敗，請稍後再試');
      }
    });
  </script>
</body>
</html>
