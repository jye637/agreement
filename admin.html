<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>管理後臺 - 資安同意書紀錄</title>
<style>
body{font-family:Noto Sans TC,sans-serif;background:#f5f5f5;padding:20px;}
.container{max-width:1000px;margin:0 auto;background:#fff;padding:30px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.1);}
h1{text-align:center;color:#003366;}
table{width:100%;border-collapse:collapse;margin-top:20px;}
th,td{border:1px solid #ccc;padding:8px;text-align:center;}
th{background:#f0f0f0;}
img.signature{width:200px;height:auto;}
</style>
</head>
<body>


<div class="container">
<h1>管理後臺 - 同意書紀錄</h1>

<table id="recordsTable">
<thead>
<tr>
<th>身分證後5碼</th>
<th>是否同意</th>
<th>簽名圖片</th>
<th>送出時間</th>
    <button id="printBtn" style="margin-bottom:20px;padding:10px 15px;background:#006600;color:#fff;border:none;border-radius:5px;cursor:pointer;">列印 PDF</button>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCk-1B0IwsSOwlNIn71-LofJRoHzgh6kJQ",
  authDomain: "signup-f163b.firebaseapp.com",
  projectId: "signup-f163b",
  storageBucket: "signup-f163b.appspot.com",
  messagingSenderId: "4965735888",
  appId: "1:4965735888:web:6ce33434885f967ed22dd5"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function loadRecords(){
  const tbody = document.querySelector("#recordsTable tbody");
  tbody.innerHTML = "";
  const q = query(collection(db,"signatures"), orderBy("timestamp","desc"));
  const snapshot = await getDocs(q);

  snapshot.forEach(doc => {
    const data = doc.data();
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${data.idLast5}</td>
      <td>${data.agree ? "同意" : "不同意"}</td>
      <td><img class="signature" src="${data.signatureUrl}"></td>
      <td>${data.timestamp ? data.timestamp.toDate().toLocaleString() : ""}</td>
    `;
    tbody.appendChild(tr);
  });
}

loadRecords();
  document.getElementById("printBtn").addEventListener("click", () => {
  window.print();
});

</script>
</body>
</html>
